<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resume Forge — Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide-static@0.259.0/dist/lucide.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    :root{--glass-bg: rgba(255,255,255,0.6);--glass-border: rgba(255,255,255,0.12);}
    [data-theme="dark"]{--glass-bg: rgba(14,20,28,0.55);--glass-border: rgba(255,255,255,0.04);}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:linear-gradient(135deg,#0f172a,#0b1220);}
    .glass{background:var(--glass-bg);backdrop-filter:blur(6px) saturate(120%);border:1px solid var(--glass-border)}
    /* preview A4 sizing */
    #paper{width:210mm;min-height:297mm;background:white}
    @media (prefers-color-scheme:dark){body{background:linear-gradient(135deg,#071024,#0b1220)}}
    .fade{transition:all .35s ease}
  </style>
</head>
<body class="min-h-screen p-6 text-slate-800" data-theme="light">
  <!-- Header -->
  <header class="max-w-7xl mx-auto flex items-center justify-between mb-6">
    <div class="flex items-center gap-3">
      <div class="w-11 h-11 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 shadow-lg"></div>
      <div>
        <div class="font-extrabold text-2xl text-white">Resume Forge</div>
        <div class="text-xs text-slate-300">Polished resumes — built fast</div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <label class="flex items-center gap-2 text-sm text-slate-300">
        <input id="themeToggle" type="checkbox" class="h-5 w-10" />
        Dark
      </label>
      <button id="loadDraft" class="px-3 py-1 rounded-md glass text-sm text-white">Load Draft</button>
      <button id="helpBtn" class="px-3 py-1 rounded-md glass text-sm text-white">Help</button>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left: Builder -->
    <section class="lg:col-span-1 space-y-4">
      <div class="glass rounded-2xl p-4 shadow-md">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold text-white">Build</h3>
          <div class="text-sm text-slate-300">Progress: <span id="progressPct">0%</span></div>
        </div>
        <div class="w-full bg-slate-800/30 rounded-full h-2 overflow-hidden mb-3">
          <div id="progressBar" class="h-2 bg-gradient-to-r from-indigo-500 to-purple-500 w-0"></div>
        </div>
        <div class="space-y-3">
          <label class="block text-xs text-slate-300">Full name</label>
          <input id="name" class="w-full rounded-lg p-2 bg-transparent border border-white/10 text-white placeholder:text-slate-400" placeholder="Surya Pratap Singh" />

          <label class="block text-xs text-slate-300">Title</label>
          <input id="title" class="w-full rounded-lg p-2 bg-transparent border border-white/10 text-white" placeholder="Frontend Developer" />

          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="block text-xs text-slate-300">Email</label>
              <input id="email" class="w-full rounded-lg p-2 bg-transparent border border-white/10 text-white" placeholder="you@example.com" />
            </div>
            <div>
              <label class="block text-xs text-slate-300">Phone</label>
              <input id="phone" class="w-full rounded-lg p-2 bg-transparent border border-white/10 text-white" placeholder="+91 9xxxxxxxxx" />
            </div>
          </div>

          <label class="block text-xs text-slate-300">Summary</label>
          <textarea id="summary" rows="3" class="w-full rounded-lg p-2 bg-transparent border border-white/10 text-white" placeholder="Add a short professional summary"></textarea>

          <div class="flex gap-2">
            <button id="addEdu" class="flex-1 px-3 py-2 rounded-lg bg-indigo-600 text-white">+ Education</button>
            <button id="addExp" class="flex-1 px-3 py-2 rounded-lg bg-violet-600 text-white">+ Experience</button>
          </div>

        </div>
      </div>

      <!-- Repeatable lists with drag & drop -->
      <div class="glass rounded-2xl p-4 shadow-md space-y-3">
        <div class="flex items-center justify-between">
          <h4 class="text-white font-semibold">Sections (drag to reorder)</h4>
          <div class="text-sm text-slate-300">Click cards to edit</div>
        </div>
        <div id="sectionsList" class="space-y-2">
          <!-- items added dynamically -->
        </div>
      </div>

      <!-- Template gallery + customization -->
      <div class="glass rounded-2xl p-4 shadow-md">
        <h4 class="text-white font-semibold mb-2">Templates</h4>
        <div class="grid grid-cols-2 gap-3 mb-3">
          <button data-template="modern" class="templateCard p-2 rounded-lg border border-white/8 text-left bg-white/5">
            <div class="font-semibold text-sm text-white">Modern</div>
            <div class="text-xs text-slate-300">Accent header, two-tone</div>
          </button>
          <button data-template="minimal" class="templateCard p-2 rounded-lg border border-white/8 text-left bg-white/5">
            <div class="font-semibold text-sm text-white">Minimal</div>
            <div class="text-xs text-slate-300">Classic, ATS friendly</div>
          </button>
          <button data-template="creative" class="templateCard p-2 rounded-lg border border-white/8 text-left bg-white/5">
            <div class="font-semibold text-sm text-white">Creative</div>
            <div class="text-xs text-slate-300">Side column, bold accents</div>
          </button>
          <button data-template="twoColumn" class="templateCard p-2 rounded-lg border border-white/8 text-left bg-white/5">
            <div class="font-semibold text-sm text-white">Two Column</div>
            <div class="text-xs text-slate-300">Compact, info-dense</div>
          </button>
        </div>

        <div class="mb-3">
          <label class="text-xs text-slate-300">Accent color</label>
          <input id="accent" type="color" value="#6d28d9" class="w-full h-8 rounded-md" />
        </div>
        <div class="flex gap-2">
          <button id="previewBtn" class="flex-1 bg-white text-indigo-700 font-semibold py-2 rounded-lg">Preview</button>
          <button id="downloadBtn" class="flex-1 bg-indigo-600 text-white font-semibold py-2 rounded-lg" disabled>Download PDF</button>
        </div>
      </div>

      <div class="glass rounded-2xl p-4 text-sm text-slate-300">Pro tip: Use the <strong>Load Draft</strong> button to restore saved progress from previous sessions. Drag to reorder your sections and preview frequently.</div>
    </section>

    <!-- Middle: Preview area -->
    <section class="lg:col-span-2 space-y-4">
      <div class="flex items-center justify-between">
        <h3 class="text-white font-bold">Live A4 Preview</h3>
        <div class="flex items-center gap-3">
          <select id="fontSelect" class="rounded-md p-2 bg-white/5 text-white">
            <option value="Inter">Inter</option>
            <option value="Merriweather">Merriweather</option>
            <option value="Arial">Arial</option>
          </select>
          <button id="saveBtn" class="px-3 py-1 rounded-md glass text-white">Save Draft</button>
        </div>
      </div>

      <div id="previewFrame" class="bg-slate-900 p-6 rounded-2xl overflow-auto">
        <div id="paper" class="mx-auto shadow-2xl rounded-md p-6" style="width:794px;">
          <!-- dynamic resume content -->
        </div>
      </div>
    </section>
  </main>

  <!-- Templates as functions (keeps HTML compact) -->
  <template id="eduTpl"><div class="p-3 rounded-lg bg-white/3 border border-white/6"><div class="flex justify-between"><strong class="edu-degree">B.E. in ECE</strong><span class="edu-year">2021 - 2025</span></div><div class="text-xs edu-school">RNS Institute</div></div></template>

  <script>
    // tiny DOM helpers
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    // state
    let state = {
      name:'', title:'', email:'', phone:'', summary:'', sections:[], template:'modern', accent:'#6d28d9', font:'Inter'
    };

    // load saved draft
    function loadDraft(){
      const raw = localStorage.getItem('resumeForge:pro');
      if(raw){ state = JSON.parse(raw); populateFromState(); renderPreview(); alert('Draft loaded'); }
      else alert('No saved draft found');
    }
    $('#loadDraft').addEventListener('click', loadDraft);

    // save
    $('#saveBtn').addEventListener('click', ()=>{ collectState(); localStorage.setItem('resumeForge:pro', JSON.stringify(state)); alert('Saved locally'); });

    // bind simple inputs
    ['name','title','email','phone','summary'].forEach(id=>{ const el=$("#"+id); el.addEventListener('input', ()=>{ state[id]=el.value; updateProgress(); }); });
    $('#accent').addEventListener('input', e=>{ state.accent = e.target.value; renderPreview(); });
    $('#fontSelect').addEventListener('change', e=>{ state.font = e.target.value; renderPreview(); });

    // theme toggle
    $('#themeToggle').addEventListener('change', e=>{ document.body.setAttribute('data-theme', e.target.checked ? 'dark' : 'light'); });

    // add sections
    function makeSection(type){
      const id = Math.random().toString(36).slice(2,9);
      const s = { id, type, title: type==='edu' ? 'Education' : type==='exp' ? 'Experience' : 'Project', fields:{} };
      // default fields
      if(type==='edu'){ s.fields.degree='B.E. in ECE'; s.fields.school='RNS Institute'; s.fields.start='2021'; s.fields.end='2025'; s.fields.desc=['CGPA: 9.1']; }
      if(type==='exp'){ s.fields.role='SDE Intern'; s.fields.company='ACME'; s.fields.start='Jan 2024'; s.fields.end='Jun 2024'; s.fields.desc=['Built feature X']; }
      if(type==='project'){ s.fields.name='Resume Builder'; s.fields.link=''; s.fields.desc=['Built with HTML/CSS/JS']; }
      state.sections.push(s); renderSections(); updateProgress();
    }
    $('#addEdu').addEventListener('click', ()=> makeSection('edu'));
    $('#addExp').addEventListener('click', ()=> makeSection('exp'));

    function renderSections(){
      const list = $('#sectionsList'); list.innerHTML='';
      state.sections.forEach(s=>{
        const el = document.createElement('div'); el.className='p-3 rounded-lg bg-white/5 border border-white/6 flex justify-between items-start gap-3 cursor-move'; el.dataset.id = s.id;
        el.innerHTML = `<div>
            <div class="font-semibold text-white">${escapeHtml(s.title)}</div>
            <div class="text-xs text-slate-300">${summaryForSection(s)}</div>
          </div>
          <div class="flex gap-2">
            <button class="editBtn px-2 py-1 rounded bg-indigo-600 text-white">Edit</button>
            <button class="delBtn px-2 py-1 rounded bg-rose-600 text-white">Delete</button>
          </div>`;
        list.appendChild(el);
        el.querySelector('.editBtn').addEventListener('click', ()=> editSection(s.id));
        el.querySelector('.delBtn').addEventListener('click', ()=>{ if(confirm('Remove this section?')){ state.sections = state.sections.filter(x=>x.id!==s.id); renderSections(); renderPreview(); updateProgress(); }});
      });
      // make sortable
      new Sortable(list, { animation:150, onEnd:e=>{ const ids = Array.from(list.children).map(x=>x.dataset.id); state.sections = ids.map(id=> state.sections.find(s=>s.id===id)); renderPreview(); } });
    }

    function summaryForSection(s){ if(s.type==='edu') return `${s.fields.degree} • ${s.fields.school}`; if(s.type==='exp') return `${s.fields.role} • ${s.fields.company}`; if(s.type==='project') return `${s.fields.name}`; return '' }

    function editSection(id){ const s = state.sections.find(x=>x.id===id); if(!s) return; const modal = window.prompt('Edit JSON for this section (advanced)
Leave as is to cancel', JSON.stringify(s.fields,null,2)); if(modal){ try{ s.fields = JSON.parse(modal); renderSections(); renderPreview(); updateProgress(); }catch(e){ alert('Invalid JSON'); } } }

    // template selection
    $$('.templateCard').forEach(btn=> btn.addEventListener('click', e=>{ state.template = btn.dataset.template; $$('.templateCard').forEach(b=>b.classList.remove('ring-2','ring-indigo-400')); btn.classList.add('ring-2','ring-indigo-400'); renderPreview(); }));

    // helper: escapeHtml
    function escapeHtml(s){ return (s||'').toString().replace(/[&<>\"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m])); }

    // collect state from inputs for save
    function collectState(){ state.name = $('#name').value; state.title = $('#title').value; state.email = $('#email').value; state.phone = $('#phone').value; state.summary = $('#summary').value; state.accent = $('#accent').value; state.font = $('#fontSelect').value; }

    function populateFromState(){ $('#name').value = state.name||''; $('#title').value=state.title||''; $('#email').value=state.email||''; $('#phone').value=state.phone||''; $('#summary').value=state.summary||''; $('#accent').value = state.accent||'#6d28d9'; $('#fontSelect').value = state.font||'Inter'; renderSections(); }

    // progress calculation
    function updateProgress(){ collectState(); const checks = [state.name, state.email, state.title, state.summary, state.sections.length]; let filled = checks.filter(Boolean).length; let pct = Math.round((filled / checks.length) * 100); $('#progressPct').innerText = pct + '%'; $('#progressBar').style.width = pct + '%'; }

    // rendering preview templates
    function renderPreview(){ collectState(); const container = $('#paper'); container.style.fontFamily = state.font === 'Merriweather' ? 'Merriweather, serif' : 'Inter, system-ui, sans-serif'; container.innerHTML = '';
      if(state.template==='modern') container.innerHTML = renderModern(state); else if(state.template==='minimal') container.innerHTML = renderMinimal(state);
      else if(state.template==='creative') container.innerHTML = renderCreative(state); else container.innerHTML = renderTwoColumn(state);
      // enable download
      $('#downloadBtn').disabled = !state.name; $('#downloadBtn').onclick = downloadPDF;
    }

    function renderModern(d){
      const accent = d.accent;
      return `
      <div style="border-radius:8px; overflow:hidden; width:100%">
        <div style="background:${accent}; color:white; padding:22px">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <div style="font-weight:800; font-size:24px">${escapeHtml(d.name||'Your Name')}</div>
              <div style="opacity:0.9">${escapeHtml(d.title||'Title')}</div>
            </div>
            <div style="text-align:right; font-size:12px; opacity:0.95">
              ${escapeHtml(d.email||'')}${d.email?'<br/>':''}${escapeHtml(d.phone||'')}
            </div>
          </div>
        </div>
        <div style="padding:18px">
          ${d.summary?`<p style="margin-bottom:12px">${escapeHtml(d.summary)}</p>`:''}
          ${renderSectionBlocks(d)}
        </div>
      </div>`;
    }

    function renderMinimal(d){
      return `
      <div style="padding:20px">
        <div style="text-align:center; margin-bottom:12px">
          <div style="font-weight:700; font-size:20px">${escapeHtml(d.name||'Your Name')}</div>
          <div style="font-size:12px; color:#555">${escapeHtml(d.title||'Title')} • ${escapeHtml(d.email||'')}</div>
        </div>
        ${d.summary?`<p style="margin-bottom:12px">${escapeHtml(d.summary)}</p>`:''}
        ${renderSectionBlocks(d)}
      </div>`;
    }

    function renderCreative(d){
      const accent = d.accent;
      return `
      <div style="display:flex">
        <div style="width:28%; background:${accent}; color:white; padding:18px">
          <div style="font-weight:700; font-size:18px">${escapeHtml(d.name||'Your Name')}</div>
          <div style="margin-top:8px">${escapeHtml(d.title||'Title')}</div>
          <div style="margin-top:12px; font-size:12px">${escapeHtml(d.email||'')}</div>
        </div>
        <div style="flex:1; padding:18px">
          ${d.summary?`<p style="margin-bottom:12px">${escapeHtml(d.summary)}</p>`:''}
          ${renderSectionBlocks(d)}
        </div>
      </div>`;
    }

    function renderTwoColumn(d){
      return `
      <div style="display:flex; gap:16px">
        <div style="width:45%; padding:12px">
          ${renderLeftColumn(d)}
        </div>
        <div style="flex:1; padding:12px">
          ${renderRightColumn(d)}
        </div>
      </div>`;
    }

    function renderLeftColumn(d){
      let html = '';
      if(d.sections.length){ d.sections.forEach(s=>{ if(s.type==='edu'){ html += `<div style="margin-bottom:10px"><strong>${escapeHtml(s.fields.degree||'')}</strong><div class="text-xs">${escapeHtml(s.fields.school||'')}</div></div>` } if(s.type==='project'){ html += `<div style="margin-bottom:10px"><strong>${escapeHtml(s.fields.name||'')}</strong><div class="text-xs">${escapeHtml(s.fields.link||'')}</div></div>` } }); }
      return html;
    }
    function renderRightColumn(d){ return renderSectionBlocks(d); }

    function renderSectionBlocks(d){
      let out = '';
      d.sections.forEach(s=>{
        if(s.type==='edu'){
          out += `<div style="margin-bottom:10px"><div style="font-weight:700">${escapeHtml(s.fields.degree||'')}</div><div style="font-size:12px;color:#666">${escapeHtml(s.fields.school||'')} • ${escapeHtml(s.fields.start||'')} - ${escapeHtml(s.fields.end||'')}</div>${listHtml(s.fields.desc)}</div>`;
        } else if(s.type==='exp'){
          out += `<div style="margin-bottom:10px"><div style="font-weight:700">${escapeHtml(s.fields.role||'')}</div><div style="font-size:12px;color:#666">${escapeHtml(s.fields.company||'')} • ${escapeHtml(s.fields.start||'')} - ${escapeHtml(s.fields.end||'')}</div>${listHtml(s.fields.desc)}</div>`;
        } else if(s.type==='project'){
          out += `<div style="margin-bottom:10px"><div style="font-weight:700">${escapeHtml(s.fields.name||'')}</div>${s.fields.link?`<div style="font-size:12px;color:#666">${escapeHtml(s.fields.link)}</div>`:''}${listHtml(s.fields.desc)}</div>`;
        }
      });
      return out;
    }
    function listHtml(arr){ if(!arr) return ''; return `<ul style="margin-top:6px;margin-left:16px">${arr.map(it=>`<li style="font-size:13px;color:#333">${escapeHtml(it)}</li>`).join('')}</ul>`; }

    // small UI: edit trigger to edit JSON of a section
    function editSectionJson(id){ const s = state.sections.find(x=>x.id===id); if(!s) return; const json = prompt('Edit section JSON', JSON.stringify(s.fields,null,2)); if(json){ try{ s.fields = JSON.parse(json); renderSections(); renderPreview(); }catch(e){ alert('Invalid JSON'); } } }

    // initial seed
    state.template='modern'; makeSection('edu'); makeSection('exp'); renderSections(); renderPreview(); updateProgress();

    // preview & download
    $('#previewBtn').addEventListener('click', ()=>{ renderPreview(); alert('Preview updated'); });

    function downloadPDF(){
      // temporarily ensure white background for pdf
      const opt = { margin:10, filename: (state.name||'resume') + '.pdf', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2, useCORS:true}, jsPDF:{unit:'mm', format:'a4', orientation:'portrait'} };
      html2pdf().set(opt).from(document.querySelector('#paper')).save();
    }

    // template card keyboard focus
    $$('.templateCard').forEach(b=> b.addEventListener('keydown', e=>{ if(e.key==='Enter') b.click(); }));

    // allow quick add project
    document.addEventListener('keydown', e=>{ if(e.ctrlKey && e.key==='p'){ makeSection('project'); renderSections(); } });

  </script>
</body>
</html>
